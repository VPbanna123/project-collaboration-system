// Team Service - Owns Team, TeamMember, TeamInvitation data
// Database: team_db (port: 5433)

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Team - PRIMARY DATA OWNER
model Team {
  id          String   @id @default(cuid())
  name        String
  description String?
  imageUrl    String?
  createdById String   // Reference to User in user-service (no FK)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  members     TeamMember[]
  invitations TeamInvitation[]

  @@index([createdById])
  @@map("teams")
}

// Team membership with roles - PRIMARY DATA OWNER
model TeamMember {
  id       String   @id @default(cuid())
  teamId   String
  userId   String   // Reference to User in user-service (no FK)
  role     TeamRole @default(MEMBER)
  joinedAt DateTime @default(now())

  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([teamId, userId])
  @@index([teamId])
  @@index([userId])
  @@map("team_members")
}

enum TeamRole {
  ADMIN
  MEMBER
}

// Team invitations - PRIMARY DATA OWNER
model TeamInvitation {
  id        String           @id @default(cuid())
  teamId    String
  email     String
  role      TeamRole         @default(MEMBER)
  status    InvitationStatus @default(PENDING)
  invitedBy String           // Reference to User in user-service (no FK)
  createdAt DateTime         @default(now())
  expiresAt DateTime

  team Team @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@unique([teamId, email])
  @@index([teamId])
  @@index([email])
  @@index([status])
  @@map("team_invitations")
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  DECLINED
  EXPIRED
}

// Denormalized user data for faster queries (synced from user-service)
model UserSnapshot {
  id        String   @id
  userId    String   @unique
  email     String
  name      String?
  imageUrl  String?
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@map("user_snapshots")
}